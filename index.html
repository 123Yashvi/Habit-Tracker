<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff" />
    <link rel="manifest" href="manifest.json">
    <title>Smart Goal Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #0077cc;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        section {
            margin: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin-top: 0.5rem;
        }
        input, select, button {
            padding: 0.5rem;
            margin-top: 0.2rem;
            width: 100%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 0.5rem;
            text-align: center;
        }
        .status-green { background-color: #d4edda; }
        .status-orange { background-color: #fff3cd; }
        .status-red { background-color: #f8d7da; }
    </style>
</head><body>
    <header>
        <h1>Smart Goal Tracker</h1>
    </header><section>
    <h2>Enter Progress</h2>
    <label for="goalSelect">Select Goal</label>
    <select id="goalSelect"></select>

    <label for="progressDate">Date</label>
    <input type="date" id="progressDate">

    <label for="progressValue">Value (Amount, Time, Yes/No)</label>
    <input type="text" id="progressValue">

    <button onclick="addProgress()">Add Progress</button>
</section>

<section>
    <h2>Add/Edit Goal</h2>
    <label for="goalName">Goal Name</label>
    <input type="text" id="goalName">

    <label for="goalType">Goal Type</label>
    <select id="goalType">
        <option value="amount">Amount</option>
        <option value="yesno">Yes/No</option>
        <option value="time">Time</option>
    </select>

    <label for="targetAmount">Target Amount (if applicable)</label>
    <input type="number" id="targetAmount">

    <label for="targetUnit">Target Unit</label>
    <input type="text" id="targetUnit">

    <label for="startDate">Start Date</label>
    <input type="date" id="startDate">

    <label for="endDate">End Date</label>
    <input type="date" id="endDate">

    <button onclick="saveGoal()">Save Goal</button>
</section>

<section>
    <h2>Goals Summary</h2>
    <div id="goalsTableContainer"></div>
</section>

<section>
    <h2>Progress Graph</h2>
    <canvas id="progressChart"></canvas>
</section>

<script>
    let goals = JSON.parse(localStorage.getItem('goals') || '[]');
    let progress = JSON.parse(localStorage.getItem('progress') || '[]');

    function saveGoal() {
        const goal = {
            id: Date.now(),
            name: document.getElementById('goalName').value,
            type: document.getElementById('goalType').value,
            targetAmount: parseFloat(document.getElementById('targetAmount').value) || 0,
            unit: document.getElementById('targetUnit').value,
            start: document.getElementById('startDate').value,
            end: document.getElementById('endDate').value
        };
        goals.push(goal);
        localStorage.setItem('goals', JSON.stringify(goals));
        renderGoals();
    }

    function addProgress() {
        const goalId = parseInt(document.getElementById('goalSelect').value);
        const date = document.getElementById('progressDate').value || new Date().toISOString().split('T')[0];
        let value = document.getElementById('progressValue').value.trim().toLowerCase();
        if (value === 'y') value = 'yes';
        if (value === 'n') value = 'no';
        progress.push({ goalId, date, value });
        localStorage.setItem('progress', JSON.stringify(progress));
        renderGoals();
    }

    function renderGoals() {
        document.getElementById('goalSelect').innerHTML = goals.map(g => `<option value="${g.id}">${g.name}</option>`).join('');
        const table = `<table><tr><th>Name</th><th>Type</th><th>Progress</th><th>Status</th></tr>` +
            goals.map(goal => {
                const logs = progress.filter(p => p.goalId === goal.id);
                let progressValue = 0;
                if (goal.type === 'amount') {
                    progressValue = logs.reduce((sum, l) => sum + parseFloat(l.value || 0), 0);
                } else if (goal.type === 'yesno') {
                    progressValue = logs.filter(l => l.value === 'yes').length;
                } else if (goal.type === 'time') {
                    progressValue = logs.length; // just count entries
                }
                const percentage = goal.targetAmount ? (progressValue / goal.targetAmount) * 100 : 0;
                let statusClass = 'status-green';
                if (percentage < 33) statusClass = 'status-red';
                else if (percentage < 66) statusClass = 'status-orange';

                return `<tr class="${statusClass}"><td>${goal.name}</td><td>${goal.type}</td><td>${progressValue} ${goal.unit || ''}</td><td>${percentage.toFixed(1)}%</td></tr>`;
            }).join('') + '</table>';
        document.getElementById('goalsTableContainer').innerHTML = table;
        updateChart();
    }

    function updateChart() {
        const ctx = document.getElementById('progressChart').getContext('2d');
        const chartData = goals.map(g => {
            const logs = progress.filter(p => p.goalId === g.id);
            if (g.type === 'amount') return logs.reduce((sum, l) => sum + parseFloat(l.value || 0), 0);
            if (g.type === 'yesno') return logs.filter(l => l.value === 'yes').length;
            return logs.length;
        });
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: goals.map(g => g.name),
                datasets: [{
                    label: 'Progress',
                    data: chartData,
                    backgroundColor: '#0077cc'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    renderGoals();
</script>

</body></html>
