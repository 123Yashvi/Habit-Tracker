<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Goal Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4a6fa5;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --light: #f8f9fa;
      --dark: #343a40;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h2 {
      color: var(--primary);
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 10px;
    }
    
    .card {
      background-color: white;
      margin-bottom: 20px;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--dark);
    }
    
    input, select, button {
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
      width: 100%;
      font-size: 16px;
    }
    
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }
    
    button.btn-success {
      background-color: var(--success);
    }
    
    button.btn-danger {
      background-color: var(--danger);
    }
    
    button.btn-warning {
      background-color: var(--warning);
      color: var(--dark);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    th {
      background-color: var(--primary);
      color: white;
      position: sticky;
      top: 0;
    }
    
    tr:hover {
      background-color: #f5f5f5;
    }
    
    .status {
      padding: 5px 10px;
      border-radius: 20px;
      font-weight: 600;
      text-align: center;
    }
    
    .status-good {
      background-color: #d4edda;
      color: #155724;
    }
    
    .status-warning {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .status-danger {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .progress-container {
      display: flex;
      align-items: center;
    }
    
    .progress-bar {
      flex-grow: 1;
      height: 20px;
      background-color: #e9ecef;
      border-radius: 10px;
      margin-right: 10px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background-color: var(--success);
      transition: width 0.3s;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
    }
    
    .action-buttons button {
      padding: 5px 10px;
      font-size: 14px;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    
    .tab.active {
      border-bottom-color: var(--primary);
      font-weight: 600;
      color: var(--primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    #chartContainer {
      margin-top: 40px;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background-color: var(--success);
      color: white;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 1000;
      display: none;
    }
    
    @media (max-width: 768px) {
      .action-buttons {
        flex-direction: column;
      }
      
      table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2><i class="fas fa-bullseye"></i> Smart Goal Tracker</h2>
    
    <div class="notification" id="notification"></div>
    
    <div class="tabs">
      <div class="tab active" onclick="switchTab('goals')">My Goals</div>
      <div class="tab" onclick="switchTab('progress')">Add Progress</div>
      <div class="tab" onclick="switchTab('analytics')">Analytics</div>
    </div>
    
    <div id="goals" class="tab-content active">
      <div class="card">
        <h3><i class="fas fa-plus-circle"></i> Add New Goal</h3>
        <form id="goalForm">
          <div class="form-group">
            <label for="goalName">Goal Name</label>
            <input type="text" id="goalName" placeholder="e.g., Walk 10,000 steps daily" required>
          </div>
          
          <div class="form-group">
            <label for="goalType">Goal Type</label>
            <select id="goalType" onchange="toggleFields()">
              <option value="quantity">Quantity (Numbers)</option>
              <option value="time">Time-Based</option>
              <option value="boolean">Yes/No Habit</option>
            </select>
          </div>
          
          <div class="form-group" id="amountSection">
            <label for="targetAmount">Target Amount</label>
            <input type="number" id="targetAmount" placeholder="e.g., 10000">
          </div>
          
          <div class="form-group">
            <label for="unit">Measurement Unit</label>
            <select id="unit">
              <option value="steps">Steps</option>
              <option value="minutes">Minutes</option>
              <option value="hours">Hours</option>
              <option value="days">Days</option>
              <option value="times">Times</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="targetNature">Target Type</label>
            <select id="targetNature">
              <option value="atleast">Minimum (At Least)</option>
              <option value="atmost">Maximum (At Most)</option>
              <option value="exact">Exact Target</option>
            </select>
          </div>
          
          <div class="form-row" style="display: flex; gap: 15px;">
            <div class="form-group" style="flex: 1;">
              <label for="startDate">Start Date</label>
              <input type="date" id="startDate">
            </div>
            <div class="form-group" style="flex: 1;">
              <label for="endDate">End Date</label>
              <input type="date" id="endDate">
            </div>
          </div>
          
          <button type="submit" class="btn-success"><i class="fas fa-plus"></i> Add Goal</button>
        </form>
      </div>
      
      <div class="card">
        <h3><i class="fas fa-tasks"></i> My Goals</h3>
        <table id="goalSummary">
          <thead>
            <tr>
              <th>Goal</th>
              <th>Progress</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    
    <div id="progress" class="tab-content">
      <div class="card">
        <h3><i class="fas fa-chart-line"></i> Track Progress</h3>
        <form id="progressForm">
          <div class="form-group">
            <label for="progressGoal">Select Goal</label>
            <select id="progressGoal" required onchange="toggleProgressFields()">
              <option value="">-- Select a Goal --</option>
            </select>
          </div>
          
          <div id="progressAmountSection" class="form-group">
            <label for="progressAmount">Amount Completed</label>
            <input type="number" id="progressAmount" placeholder="e.g., 5000">
          </div>
          
          <div id="progressTimeSection" class="form-group" style="display:none">
            <label for="progressTime">Time Spent (HH:MM)</label>
            <input type="time" id="progressTime">
          </div>
          
          <div id="progressYesNoSection" class="form-group" style="display:none">
            <label for="progressYesNo">Did you complete it today?</label>
            <select id="progressYesNo">
              <option value="yes">Yes, I did it!</option>
              <option value="no">No, I didn't</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="progressDate">Date</label>
            <input type="date" id="progressDate" required>
          </div>
          
          <div class="form-group">
            <label for="progressNotes">Notes (Optional)</label>
            <textarea id="progressNotes" rows="3" style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ddd;"></textarea>
          </div>
          
          <button type="submit" class="btn-success"><i class="fas fa-save"></i> Save Progress</button>
        </form>
      </div>
    </div>
    
    <div id="analytics" class="tab-content">
      <div class="card">
        <h3><i class="fas fa-chart-pie"></i> Progress Analytics</h3>
        <div id="chartContainer">
          <canvas id="progressChart" width="400" height="200"></canvas>
        </div>
      </div>
      
      <div class="card">
        <h3><i class="fas fa-cog"></i> Data Management</h3>
        <div class="action-buttons" style="justify-content: center; margin-top: 20px;">
          <button onclick="exportData()" class="btn-success"><i class="fas fa-file-export"></i> Export Data</button>
          <button onclick="document.getElementById('importFile').click()" class="btn-warning"><i class="fas fa-file-import"></i> Import Data</button>
          <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
          <button onclick="addSampleData()" class="btn-warning"><i class="fas fa-magic"></i> Add Sample Data</button>
          <button onclick="clearAllData()" class="btn-danger"><i class="fas fa-trash"></i> Clear All Data</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let goals = [];
    let progressChart = null;
    const today = new Date().toISOString().split('T')[0];

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      // Set default dates
      document.getElementById('startDate').value = today;
      document.getElementById('progressDate').value = today;
      
      // Load any saved data
      loadData();
      
      // Set up form event listeners
      document.getElementById('goalForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addGoal();
      });

      document.getElementById('progressForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addProgress();
      });
      
      // Initialize UI
      updateGoalSelect();
      updateGoalList();
      drawChart();
    });

    function switchTab(tabId) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deactivate all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Activate selected tab
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
      
      // Redraw chart when analytics tab is opened
      if (tabId === 'analytics') {
        drawChart();
      }
    }

    function toggleFields() {
      const goalType = document.getElementById('goalType').value;
      const amountSection = document.getElementById('amountSection');
      
      if (goalType === 'boolean') {
        amountSection.style.display = 'none';
        document.getElementById('unit').value = '';
      } else {
        amountSection.style.display = 'block';
      }
    }

    function toggleProgressFields() {
      const selectedOption = document.querySelector('#progressGoal option:checked');
      if (!selectedOption) return;
      
      const goalType = selectedOption.dataset.type;
      document.getElementById('progressAmountSection').style.display = goalType === 'quantity' ? 'block' : 'none';
      document.getElementById('progressTimeSection').style.display = goalType === 'time' ? 'block' : 'none';
      document.getElementById('progressYesNoSection').style.display = goalType === 'boolean' ? 'block' : 'none';
    }

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.style.display = 'block';
      notification.style.backgroundColor = type === 'success' ? 'var(--success)' : 
                                         type === 'error' ? 'var(--danger)' : 
                                         'var(--primary)';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    function addGoal() {
      const goalName = document.getElementById('goalName').value.trim();
      if (!goalName) {
        showNotification('Please enter a goal name', 'error');
        return;
      }
      
      const goalType = document.getElementById('goalType').value;
      const targetAmount = document.getElementById('targetAmount').value;
      
      if (goalType !== 'boolean' && !targetAmount) {
        showNotification('Please enter a target amount', 'error');
        return;
      }
      
      const goal = {
        id: Date.now().toString(),
        name: goalName,
        type: goalType,
        target: goalType === 'boolean' ? 'yes' : targetAmount,
        unit: document.getElementById('unit').value,
        startDate: document.getElementById('startDate').value || today,
        endDate: document.getElementById('endDate').value || '',
        targetNature: document.getElementById('targetNature').value,
        progress: [],
        createdAt: new Date().toISOString()
      };
      
      goals.push(goal);
      saveData();
      updateGoalSelect();
      updateGoalList();
      drawChart();
      document.getElementById('goalForm').reset();
      
      // Reset default dates
      document.getElementById('startDate').value = today;
      
      showNotification('Goal added successfully!');
    }

    function addProgress() {
      const goalId = document.getElementById('progressGoal').value;
      if (!goalId) {
        showNotification('Please select a goal', 'error');
        return;
      }
      
      const date = document.getElementById('progressDate').value;
      if (!date) {
        showNotification('Please select a date', 'error');
        return;
      }
      
      const goal = goals.find(g => g.id === goalId);
      if (!goal) {
        showNotification('Selected goal not found', 'error');
        return;
      }
      
      let value;
      if (goal.type === 'time') {
        value = document.getElementById('progressTime').value;
      } else if (goal.type === 'boolean') {
        value = document.getElementById('progressYesNo').value;
      } else {
        value = document.getElementById('progressAmount').value;
        if (!value) {
          showNotification('Please enter progress amount', 'error');
          return;
        }
      }
      
      const notes = document.getElementById('progressNotes').value.trim();
      
      const progress = { 
        date, 
        value,
        notes,
        recordedAt: new Date().toISOString()
      };
      
      goal.progress.push(progress);
      saveData();
      updateGoalList();
      drawChart();
      document.getElementById('progressForm').reset();
      
      // Reset date to today
      document.getElementById('progressDate').value = today;
      
      showNotification('Progress recorded successfully!');
    }

    function updateGoalSelect() {
      const select = document.getElementById('progressGoal');
      const currentValue = select.value;
      select.innerHTML = '<option value="">-- Select a Goal --</option>';
      
      goals.forEach(goal => {
        const option = document.createElement('option');
        option.value = goal.id;
        option.textContent = goal.name;
        option.dataset.type = goal.type;
        select.appendChild(option);
      });
      
      // Restore selected value if possible
      if (currentValue && goals.some(g => g.id === currentValue)) {
        select.value = currentValue;
      }
      
      toggleProgressFields();
    }

    function updateGoalList() {
      const tbody = document.querySelector('#goalSummary tbody');
      tbody.innerHTML = '';
      
      if (goals.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="4" style="text-align: center;">No goals yet. Add your first goal above!</td>';
        tbody.appendChild(row);
        return;
      }
      
      goals.forEach(goal => {
        const row = document.createElement('tr');
        
        // Calculate progress metrics
        let achieved = 0;
        let percentage = 0;
        let status = 'status-good';
        
        if (goal.type === 'boolean') {
          achieved = goal.progress.filter(p => p.value === 'yes').length;
          percentage = goal.progress.length > 0 ? (achieved / goal.progress.length) * 100 : 0;
        } else if (goal.type === 'time') {
          // Simplified time calculation (in minutes)
          achieved = goal.progress.reduce((sum, p) => {
            const [hours, mins] = p.value.split(':').map(Number);
            return sum + hours * 60 + mins;
          }, 0);
          
          const [targetHours, targetMins] = goal.target.split(':').map(Number);
          const targetInMinutes = targetHours * 60 + targetMins;
          percentage = targetInMinutes > 0 ? Math.min((achieved / targetInMinutes) * 100, 100) : 0;
        } else {
          achieved = goal.progress.reduce((sum, p) => sum + Number(p.value || 0), 0);
          percentage = goal.target > 0 ? Math.min((achieved / goal.target) * 100, 100) : 0;
        }
        
        // Determine status
        if (percentage < 50) {
          status = 'status-danger';
        } else if (percentage < 80) {
          status = 'status-warning';
        }
        
        // Format displayed values
        let achievedDisplay = '';
        if (goal.type === 'boolean') {
          achievedDisplay = `${achieved}/${goal.progress.length} days`;
        } else if (goal.type === 'time') {
          const hours = Math.floor(achieved / 60);
          const mins = achieved % 60;
          achievedDisplay = `${hours}h ${mins}m`;
        } else {
          achievedDisplay = `${achieved} ${goal.unit}`;
        }
        
        row.innerHTML = `
          <td>
            <strong>${goal.name}</strong><br>
            <small>Target: ${goal.target} ${goal.unit} (${goal.targetNature})</small>
          </td>
          <td>
            <div class="progress-container">
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${percentage}%"></div>
              </div>
              <span>${Math.round(percentage)}%</span>
            </div>
            <small>Achieved: ${achievedDisplay}</small>
          </td>
          <td><span class="${status}">${Math.round(percentage)}% ${status.replace('status-', '')}</span></td>
          <td class="action-buttons">
            <button onclick="viewGoalDetails('${goal.id}')" class="btn-success"><i class="fas fa-eye"></i></button>
            <button onclick="deleteGoal('${goal.id}')" class="btn-danger"><i class="fas fa-trash"></i></button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }

    function viewGoalDetails(goalId) {
      const goal = goals.find(g => g.id === goalId);
      if (!goal) return;
      
      // Switch to progress tab
      switchTab('progress');
      
      // Select the goal in the dropdown
      document.getElementById('progressGoal').value = goalId;
      toggleProgressFields();
      
      // Scroll to the form
      document.getElementById('progressForm').scrollIntoView({ behavior: 'smooth' });
    }

    function deleteGoal(goalId) {
      if (!confirm('Are you sure you want to delete this goal and all its progress data?')) {
        return;
      }
      
      goals = goals.filter(g => g.id !== goalId);
      saveData();
      updateGoalSelect();
      updateGoalList();
      drawChart();
      
      showNotification('Goal deleted successfully');
    }

    function saveData() {
      localStorage.setItem('smartGoalTracker', JSON.stringify(goals));
    }

    function loadData() {
      const savedData = localStorage.getItem('smartGoalTracker');
      if (savedData) {
        try {
          goals = JSON.parse(savedData);
        } catch (e) {
          console.error('Failed to parse saved data', e);
        }
      }
    }

    function exportData() {
      if (goals.length === 0) {
        showNotification('No data to export', 'error');
        return;
      }
      
      const dataStr = JSON.stringify(goals, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `goals-export-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      
      showNotification('Data exported successfully');
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!confirm('Importing data will overwrite your current goals. Continue?')) {
        return;
      }
      
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const importedData = JSON.parse(e.target.result);
          if (Array.isArray(importedData)) {
            goals = importedData;
            saveData();
            updateGoalSelect();
            updateGoalList();
            drawChart();
            showNotification('Data imported successfully!');
          } else {
            showNotification('Invalid data format', 'error');
          }
        } catch (error) {
          showNotification('Error importing file: ' + error.message, 'error');
        }
      };
      reader.readAsText(file);
      
      // Reset file input
      event.target.value = '';
    }

    function addSampleData() {
      if (!confirm('This will add sample goals to help you get started. Continue?')) {
        return;
      }
      
      const sampleGoals = [
        {
          id: 'sample1',
          name: "Daily Steps Goal",
          type: "quantity",
          target: 10000,
          unit: "steps",
          startDate: today,
          endDate: "",
          targetNature: "atleast",
          progress: [
            { date: today, value: "7500", notes: "Morning walk was great!" },
            { date: getPreviousDate(today, 1), value: "8500", notes: "" },
            { date: getPreviousDate(today, 2), value: "9200", notes: "Almost there!" }
          ],
          createdAt: new Date().toISOString()
        },
        {
          id: 'sample2',
          name: "Meditation Practice",
          type: "time",
          target: "00:20",
          unit: "minutes",
          startDate: today,
          endDate: "",
          targetNature: "atleast",
          progress: [
            { date: today, value: "00:15", notes: "Focused session" },
            { date: getPreviousDate(today, 1), value: "00:25", notes: "Extra time today" }
          ],
          createdAt: new Date().toISOString()
        },
        {
          id: 'sample3',
          name: "No Junk Food",
          type: "boolean",
          target: "yes",
          unit: "",
          startDate: today,
          endDate: "",
          targetNature: "atleast",
          progress: [
            { date: today, value: "yes", notes: "Stayed strong!" },
            { date: getPreviousDate(today, 1), value: "no", notes: "Had a cookie" },
            { date: getPreviousDate(today, 2), value: "yes", notes: "Perfect day" }
          ],
          createdAt: new Date().toISOString()
        }
      ];
      
      goals = [...sampleGoals, ...goals];
      saveData();
      updateGoalSelect();
      updateGoalList();
      drawChart();
      
      showNotification('Sample data added successfully');
    }

    function getPreviousDate(currentDate, daysBack) {
      const date = new Date(currentDate);
      date.setDate(date.getDate() - daysBack);
      return date.toISOString().split('T')[0];
    }

    function clearAllData() {
      if (!confirm('This will permanently delete ALL your goals and progress. Are you sure?')) {
        return;
      }
      
      goals = [];
      saveData();
      updateGoalSelect();
      updateGoalList();
      drawChart();
      
      showNotification('All data cleared');
    }

    function drawChart() {
      const ctx = document.getElementById('progressChart').getContext('2d');
      
      // Destroy previous chart if it exists
      if (progressChart) {
        progressChart.destroy();
      }
      
      // Only draw chart if there are goals
      if (goals.length === 0) {
        document.getElementById('chartContainer').innerHTML = `
          <canvas id="progressChart" width="400" height="200"></canvas>
          <p style="text-align: center; margin-top: 20px;">No data available for chart</p>
        `;
        return;
      }
      
      // Prepare data for chart
      const labels = goals.map(g => g.name);
      const targets = goals.map(g => {
        if (g.type === 'boolean') return 100;
        if (g.type === 'time') {
          const [h, m] = g.target.split(':').map(Number);
          return h * 60 + m; // Convert to minutes
        }
        return Number(g.target);
      });
      
      const achieved = goals.map(g => {
        if (g.type === 'boolean') {
          const yesCount = g.progress.filter(p => p.value === 'yes').length;
          return g.progress.length > 0 ? (yesCount / g.progress.length) * 100 : 0;
        }
        if (g.type === 'time') {
          const totalMinutes = g.progress.reduce((sum, p) => {
            const [h, m] = p.value.split(':').map(Number);
            return sum + h * 60 + m;
          }, 0);
          return totalMinutes;
        }
        return g.progress.reduce((sum, p) => sum + Number(p.value || 0), 0);
      });
      
      // Normalize data for the chart
      const maxValue = Math.max(...targets, ...achieved);
      const normalizedTargets = targets.map(t => (t / maxValue) * 100);
      const normalizedAchieved = achieved.map((a, i) => {
        if (goals[i].type === 'boolean') return a;
        return (a / targets[i]) * 100;
      });
      
      progressChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Target',
              data: normalizedTargets,
              backgroundColor: 'rgba(54, 162, 235, 0.7)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            },
            {
              label: 'Achieved',
              data: normalizedAchieved,
              backgroundColor: 'rgba(75, 192, 192, 0.7)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                callback: function(value) {
                  return value + '%';
                }
              }
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.dataset.label || '';
                  const goal = goals[context.dataIndex];
                  
                  if (label === 'Target') {
                    if (goal.type === 'boolean') return 'Target: 100% success rate';
                    if (goal.type === 'time') {
                      const [h, m] = goal.target.split(':');
                      return `Target: ${h}h ${m}m`;
                    }
                    return `Target: ${goal.target} ${goal.unit}`;
                  } else {
                    if (goal.type === 'boolean') {
                      const yesCount = goal.progress.filter(p => p.value === 'yes').length;
                      return `Achieved: ${yesCount}/${goal.progress.length} days (${Math.round((yesCount/goal.progress.length)*100)}%)`;
                    }
                    if (goal.type === 'time') {
                      const totalMinutes = achieved[context.dataIndex];
                      const hours = Math.floor(totalMinutes / 60);
                      const mins = totalMinutes % 60;
                      const percentage = Math.round((totalMinutes / targets[context.dataIndex]) * 100);
                      return `Achieved: ${hours}h ${mins}m (${percentage}%)`;
                    }
                    const percentage = Math.round((achieved[context.dataIndex] / targets[context.dataIndex]) * 100);
                    return `Achieved: ${achieved[context.dataIndex]} ${goal.unit} (${percentage}%)`;
                  }
                }
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
