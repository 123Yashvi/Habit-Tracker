<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Goal Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h2 {
      color: #333;
    }
    form, table {
      margin-bottom: 20px;
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select, button {
      margin: 5px 0;
      padding: 10px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 100%;
    }
    button {
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }
    .status-good { background-color: #d4edda; }
    .status-warning { background-color: #fff3cd; }
    .status-danger { background-color: #f8d7da; }
    #importExportButtons {
      text-align: center;
      margin-top: 40px;
    }
    #importExportButtons button {
      margin: 10px;
      width: auto;
    }
    #chartContainer {
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <h2>Smart Goal Tracker</h2>
  
  <!-- Add Progress Section -->
  <form id="progressForm">
    <label for="progressGoal">Select Goal:</label>
    <select id="progressGoal" required onchange="toggleProgressFields()"></select>
    
    <div id="progressAmountSection">
      <label for="progressAmount">Progress Amount:</label>
      <input type="number" id="progressAmount">
    </div>

    <div id="progressTimeSection" style="display:none">
      <label for="progressTime">Progress Time (HH:MM):</label>
      <input type="time" id="progressTime">
    </div>

    <div id="progressYesNoSection" style="display:none">
      <label for="progressYesNo">Did you do it?</label>
      <select id="progressYesNo">
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </div>

    <label for="progressDate">Date:</label>
    <input type="date" id="progressDate" required>

    <button type="submit">Add Progress</button>
  </form>
  
  <!-- Add Goal Section -->
  <form id="goalForm">
    <label>Goal Name:</label>
    <input type="text" id="goalName" required>
    
    <label>Goal Type:</label>
    <select id="goalType" onchange="toggleFields()">
      <option value="normal">Normal</option>
      <option value="time">Time-Based</option>
      <option value="yesno">Yes/No</option>
    </select>

    <div id="amountSection">
      <label>Target Amount:</label>
      <input type="text" id="targetAmount">
    </div>

    <label>Target Unit:</label>
    <select id="unit">
      <option value="hr:min">Hr:Min</option>
      <option value="steps">Steps</option>
      <option value="nos">Nos</option>
    </select>

    <label>Start Date:</label>
    <input type="date" id="startDate">

    <label>End Date:</label>
    <input type="date" id="endDate">

    <label>Minimum or Maximum Target:</label>
    <select id="targetNature">
      <option value="atleast">At Least</option>
      <option value="atmost">At Most</option>
    </select>

    <button type="submit">Add Goal</button>
  </form>
  
  <table id="goalSummary">
    <thead>
      <tr>
        <th>Goal</th>
        <th>Type</th>
        <th>Target</th>
        <th>Achieved</th>
        <th>Days Done</th>
        <th>Days Left</th>
        <th>Speed Now</th>
        <th>Speed Required</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  
  <div id="importExportButtons">
    <button onclick="exportData()">üì§ Export JSON</button>
    <button onclick="document.getElementById('importFile').click()">üì• Import JSON</button>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
    <button onclick="addDummyData()">‚ûï Add Dummy Data</button>
    <button onclick="clearAllData()">‚ùå Clear All Data</button>
  </div>
  
  <div id="chartContainer">
    <canvas id="progressChart" width="400" height="200"></canvas>
  </div>

  <script>
    let goals = [];
    let progressChart = null;

    // Initialize form event listeners
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('goalForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addGoal();
      });

      document.getElementById('progressForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addProgress();
      });
    });

    function toggleFields() {
      const goalType = document.getElementById('goalType').value;
      const amountSection = document.getElementById('amountSection');
      
      if (goalType === 'yesno') {
        amountSection.style.display = 'none';
      } else {
        amountSection.style.display = 'block';
        document.getElementById('targetAmount').type = goalType === 'time' ? 'time' : 'text';
      }
    }

    function toggleProgressFields() {
      const selectedOption = document.querySelector('#progressGoal option:checked');
      if (!selectedOption) return;
      
      const goalType = selectedOption.dataset.type;
      document.getElementById('progressAmountSection').style.display = goalType === 'normal' ? 'block' : 'none';
      document.getElementById('progressTimeSection').style.display = goalType === 'time' ? 'block' : 'none';
      document.getElementById('progressYesNoSection').style.display = goalType === 'yesno' ? 'block' : 'none';
    }

    function addGoal() {
      const goal = {
        name: document.getElementById('goalName').value,
        type: document.getElementById('goalType').value,
        target: document.getElementById('targetAmount').value,
        unit: document.getElementById('unit').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        targetNature: document.getElementById('targetNature').value,
        progress: []
      };
      
      goals.push(goal);
      updateGoalSelect();
      updateGoalList();
      drawChart();
      document.getElementById('goalForm').reset();
    }

    function addProgress() {
      const goalId = document.getElementById('progressGoal').value;
      if (!goalId) return;
      
      const date = document.getElementById('progressDate').value;
      let value;
      
      const goalType = document.querySelector('#progressGoal option:checked').dataset.type;
      if (goalType === 'time') {
        value = document.getElementById('progressTime').value;
      } else if (goalType === 'yesno') {
        value = document.getElementById('progressYesNo').value;
      } else {
        value = document.getElementById('progressAmount').value;
      }
      
      const progress = { date, value };
      goals[goalId].progress.push(progress);
      updateGoalList();
      drawChart();
      document.getElementById('progressForm').reset();
    }

    function updateGoalSelect() {
      const select = document.getElementById('progressGoal');
      select.innerHTML = '';
      
      goals.forEach((goal, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = goal.name;
        option.dataset.type = goal.type;
        select.appendChild(option);
      });
    }

    function updateGoalList() {
      const tbody = document.querySelector('#goalSummary tbody');
      tbody.innerHTML = '';
      
      goals.forEach((goal, index) => {
        const row = document.createElement('tr');
        
        // Calculate progress metrics
        let achieved = 0;
        let daysDone = goal.progress.length;
        
        if (goal.type === 'normal') {
          achieved = goal.progress.reduce((sum, p) => sum + Number(p.value || 0), 0);
        } else if (goal.type === 'yesno') {
          achieved = goal.progress.filter(p => p.value === 'yes').length;
        }
        
        // Calculate status
        let status = 'status-good';
        if (goal.type === 'normal' && achieved < goal.target * 0.5) {
          status = 'status-danger';
        } else if (goal.type === 'normal' && achieved < goal.target * 0.8) {
          status = 'status-warning';
        }
        
        row.innerHTML = `
          <td>${goal.name}</td>
          <td>${goal.type}</td>
          <td>${goal.target} ${goal.unit}</td>
          <td>${achieved} ${goal.unit}</td>
          <td>${daysDone}</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td class="${status}">${status.replace('status-', '')}</td>
          <td>
            <button onclick="deleteGoal(${index})">Delete</button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }

    function deleteGoal(index) {
      if (confirm('Are you sure you want to delete this goal?')) {
        goals.splice(index, 1);
        updateGoalSelect();
        updateGoalList();
        drawChart();
      }
    }

    function exportData() {
      const dataStr = JSON.stringify(goals, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'goals.json';
      a.click();
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = e => {
        try {
          goals = JSON.parse(e.target.result);
          updateGoalSelect();
          updateGoalList();
          drawChart();
          alert("Data imported successfully!");
        } catch (error) {
          alert("Error importing file: " + error.message);
        }
      };
      reader.readAsText(file);
    }

    function addDummyData() {
      const today = new Date();
      const tomorrow = new Date();
      tomorrow.setDate(today.getDate() + 1);
      
      goals = [
        { 
          name: "Walk 10000 Steps", 
          type: "normal", 
          target: 10000, 
          unit: "steps",
          startDate: today.toISOString().split('T')[0],
          endDate: tomorrow.toISOString().split('T')[0],
          targetNature: "atleast",
          progress: [
            { date: today.toISOString().split('T')[0], value: "5000" },
            { date: tomorrow.toISOString().split('T')[0], value: "3000" }
          ]
        },
        { 
          name: "Wake Up Before 6:45", 
          type: "time", 
          target: "06:45", 
          unit: "hr:min",
          startDate: today.toISOString().split('T')[0],
          endDate: tomorrow.toISOString().split('T')[0],
          targetNature: "atmost",
          progress: [
            { date: today.toISOString().split('T')[0], value: "06:30" }
          ]
        },
        { 
          name: "Avoid Junk Food", 
          type: "yesno", 
          target: "yes", 
          unit: "",
          startDate: today.toISOString().split('T')[0],
          endDate: tomorrow.toISOString().split('T')[0],
          targetNature: "atleast",
          progress: [
            { date: today.toISOString().split('T')[0], value: "yes" }
          ]
        }
      ];
      
      updateGoalSelect();
      updateGoalList();
      drawChart();
      alert("Dummy data added!");
    }

    function clearAllData() {
      if (confirm('Are you sure you want to clear ALL data?')) {
        goals = [];
        updateGoalSelect();
        updateGoalList();
        drawChart();
        alert("All data cleared!");
      }
    }

    function drawChart() {
      const ctx = document.getElementById('progressChart').getContext('2d');
      
      // Destroy previous chart if it exists
      if (progressChart) {
        progressChart.destroy();
      }
      
      // Only draw chart if there are goals
      if (goals.length > 0) {
        progressChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: goals.map(g => g.name),
            datasets: [
              {
                label: 'Target',
                data: goals.map(g => g.type === 'normal' ? Number(g.target) : 100),
                backgroundColor: 'rgba(54, 162, 235, 0.6)'
              },
              {
                label: 'Achieved',
                data: goals.map(g => {
                  if (g.type === 'normal') {
                    return g.progress.reduce((sum, p) => sum + Number(p.value || 0), 0);
                  } else if (g.type === 'yesno') {
                    return (g.progress.filter(p => p.value === 'yes').length / g.progress.length) * 100 || 0;
                  }
                  return 0;
                }),
                backgroundColor: 'rgba(75, 192, 192, 0.6)'
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
      }
    }
  </script>
</body>
</html>
